<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Coffee Menu</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>

<body>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>
  <a-assets>
    <a-asset-item id="bear" src="coffeeBear.glb"></a-asset-item>
  </a-assets>

  <a-marker preset="hiro">

    <!-- MODEL -->
    <a-entity
      id="model"
      gltf-model="#bear"

      position="0 -0.1 0.25"
      scale="0.025 0.025 0.025"
      rotation="35 0 0">
    </a-entity>

  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<script>
const model = document.getElementById("model");

/* ---------- ROTATION ---------- */
let lastX = null;
let lastY = null;

document.addEventListener("touchstart", e => {
  if (e.touches.length === 1) {
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  }
});

document.addEventListener("touchmove", e => {
  if (e.touches.length === 1 && lastX !== null) {
    const dx = e.touches[0].clientX - lastX;
    const dy = e.touches[0].clientY - lastY;

    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;

    let r = model.getAttribute("rotation");

    r.y += dx * 0.4;               // left / right
    r.x = Math.min(Math.max(r.x + dy * 0.25, 10), 65); // tilt limit

    model.setAttribute("rotation", r);
  }
});

/* ---------- PINCH ZOOM ---------- */
let startDist = null;
let startScale = null;

document.addEventListener("touchstart", e => {
  if (e.touches.length === 2) {
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    startDist = Math.sqrt(dx*dx + dy*dy);

    const s = model.getAttribute("scale");
    startScale = s.x;
  }
});

document.addEventListener("touchmove", e => {
  if (e.touches.length === 2 && startDist) {
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const dist = Math.sqrt(dx*dx + dy*dy);

    let scale = startScale * (dist / startDist);
    scale = Math.min(Math.max(scale, 0.015), 0.06);

    model.setAttribute("scale", `${scale} ${scale} ${scale}`);
  }
});

document.addEventListener("touchend", () => {
  startDist = null;
  lastX = null;
});
</script>

</body>
</html>
